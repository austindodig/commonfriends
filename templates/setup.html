<!DOCTYPE html>
<html lang="en">
<head>
    <title>Setup Common Friends</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
</head>
<body>
    <h1>Setup Common Friends</h1>
    <p>Enter the names of your friends:</p>

    <form id="friends_form">
        <div id="friends_container">
            <label>Friend 1:</label> 
            <input type="text" name="friends[]" required>
        </div>
        <button type="button" id="add_friend">Add Friend</button>
        <button type="button" id="submit_friends">Submit</button>
    </form>

    <script>
        const socket = io.connect();
        const room = "{{ code }}";

        // Join the game room
        socket.emit('join', { room: room });

        // Add friend input field
        document.getElementById('add_friend').addEventListener('click', () => {
            const container = document.getElementById('friends_container');
            const inputCount = container.querySelectorAll('input').length + 1;

            const label = document.createElement('label');
            label.textContent = `Friend ${inputCount}:`;

            const input = document.createElement('input');
            input.type = 'text';
            input.name = 'friends[]';
            input.required = true;

            container.appendChild(document.createElement('br')); // Add line break
            container.appendChild(label);
            container.appendChild(input);
        });

        // Submit the friends list
        document.getElementById('submit_friends').addEventListener('click', () => {
            const friends = Array.from(document.querySelectorAll('input[name="friends[]"]'))
                                 .map(input => input.value.trim())
                                 .filter(value => value);

            if (friends.length > 0) {
                console.log("Emitting submit_friends:", { room: room, friends: friends });
                socket.emit('submit_friends', { room: room, friends: friends });
            } else {
                alert("Please enter at least one friend.");
            }
        });

        // Navigate to Round Start (for > 2 players)
        socket.on('navigate_to_round_start', data => {
            console.log("Navigating to Round Start:", data);
            window.location.href = `/round_start/${data.room}`;
        });

        // Navigate to Gameplay (for exactly 2 players)
        socket.on('navigate_to_gameplay', data => {
            console.log("Navigating to Gameplay:", data);
            window.location.href = `/gameplay/${data.room}`;
        });

        // Handle errors
        socket.on('error', message => {
            alert(message.message);
        });
    </script>
</body>
</html>
